<!DOCTYPE html>
<html>

<head>
    <title>04-get-json-fetch</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- ENTER YOUR REST API ORIGIN URL HERE -->
    <script>
        var wpUrl = "https://wpjs.co.uk/rest/";
    </script>
    <!-- ENTER YOUR REST API ORIGIN URL HERE -->

    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Raleway'>
  

<body>

    <!--========================== PAGEHTML =======================================================-->
    <!-- Page Container -->
    <main>
        <div class="w3-container w3-content" style="max-width:1400px;">
            <!-- W3 CSS Grid -->
            <div class="w3-row">
                <div class="w3-col m12">
                    <!-- ************************* START TEMPLATE AREA ********************************-->
                    <!-- CONTENT CARD-->
                    <div class="w3-card-4" style="width:100%;">
                        <header class="w3-container w3-blue">
                            <script>
                                document.write(' <h1 style="font-size:40px;">WordCamp wpb </h1>' + 'wpUrl = ' + wpUrl);
                            </script>
                            <!-- <h1 style="font-size:40px;">WordCamp Dublin</h1> -->
                        </header>

                        <div class="w3-container" style="width:100%;">
                            <div class="w3-row">
                                <div class="w3-col m12" style="margin-top:20px;padding-left:30px;padding-right:30px;">

                                    <br>
                                    <h3>GET JSON FETCH</h3>
                                    <div id="mainContent"></div>
                                    <!-- EXPLANATION -->
                                    <div class="outro">          
                                        <h3>
                                            We use Fetch to get data from endpoint wordcamp/v2/districts and render to
                                            div#mainContent.
                                        </h3>
                                    </div>
                                    <!-- EXPLANATION -->


                                    <!-- ================ MAIN CODE ======================= -->
                                    <script>
                                        //const ajaxURL = 'data/hello01.json'
                                        //wpUrl is web server variable
                                        const ajaxURL = 'https://wpjs.co.uk/wpb/wp-json/wordcamp/v2/districts';
                                        let message;
                                        // fetch returns a promise and a 'stream'.
                                        // We need to convert stream to JSON
                                        fetch(ajaxURL)
                                            .then(response => {
                                                console.log(response);
                                                // 404 is not an error just no result
                                                if (response.ok) {
                                                    // must have return to pass result to next .then
                                                    return response.json()
                                                }
                                                else {
                                                    console.log("ERROR")
                                                    return;
                                                }
                                               
                                            })
                                            .then(data => {
                                                // Prints result from `response.json()` in get Request
                                                console.log(data);
                                                console.log(data[0]);
                                              
                                                let outputData = `
                                                     <h2>URL: ${ajaxURL}</h2>
                                                `;
                                                for (var i = 0; i < data.length; i++) {
                                                    //console.log(data[i].ID);
                                                //Split for ease of understanding
                                                    outputData += "ID: " + data[i]["ID"] + " Title: <b>" + data[i].Name + "<br>";
                                                  
                                                }
                                                const main = document.getElementById('mainContent');
                                                main.innerHTML = outputData;
                                            })
                                            .catch(function(error)  {
                                                console.log("IN CATCH...error has occurred");
                                                console.error(error);
                                              })
                                    </script>
                                    <!-- ================ MAIN CODE ======================= -->

                                    <br><br><br>
                                </div><!-- end col m12 --->
                            </div><!-- end container card -->
                        </div> <!-- end card1 -->
                        <!-- ************************* END TEMPLATE AREA ********************************-->
                    </div><!-- endcard -->
                </div><!-- end col page -->
            </div><!-- end page row -->
        </div><!-- end page container -->
        <br><br><br><br><br>
    </main>
    <!-- End Page Container -->
</body>

</html>